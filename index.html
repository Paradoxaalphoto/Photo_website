<!DOCTYPE html><html><head><meta charset='UTF-8'><meta name='viewport' content='width=device-width, initial-scale=1.0'><title>YorN</title><script src='https://cdn.tailwindcss.com'></script><script src='https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js'></script><script src='https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js'></script><script src='https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js'></script></head><body><div class='p-4'><input id='fileInput' type='file' accept='image/*'><button id='analyzeBtn'>Analyze</button><div style='height:8px;background:#eee;margin-top:8px;'><div id='pb' style='height:8px;width:0;background:#3b82f6;'></div></div><div id='pt' style='font-size:12px;color:#666;margin-top:4px;'></div><img id='thumb' style='max-width:100%;display:none;margin-top:8px;'/><canvas id='overlay' style='display:none;margin-top:8px;border:1px solid #ddd;'></canvas><pre id='diag' style='font-size:12px;background:#f9fafb;border:1px solid #e5e7eb;padding:8px;margin-top:8px;max-height:200px;overflow:auto;'>No diagnostics yet.</pre></div><script>const CDNS=['https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/weights','https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@0.22.2/weights'];let WEIGHTS=null,modelsLoaded=false,imageBlobUrl=null;const $=id=>document.getElementById(id),pb=$('pb'),pt=$('pt'),diag=$('diag'),overlay=$('overlay'),thumb=$('thumb');function log(x){const now=new Date().toISOString();diag.textContent='['+now+']\n'+x+'\n\n'+diag.textContent;}function setP(p,t){pb.style.width=(p||0)+'%';pt.textContent=t||'';}$('fileInput').addEventListener('change',e=>{if(!e.target.files.length)return;imageBlobUrl=URL.createObjectURL(e.target.files[0]);thumb.src=imageBlobUrl;thumb.style.display='block';});async function pickCDN(){for(const b of CDNS){try{const r=await fetch(b+'/face_landmark_68_model-weights_manifest.json',{method:'HEAD'});if(r.ok){WEIGHTS=b;log('Using weights: '+b);return;}}catch(e){log('CDN err '+b+': '+e.message);}}throw new Error('No working CDN');}async function ensure(){if(modelsLoaded)return;setP(6,'Selecting CDN…');if(!WEIGHTS)await pickCDN();setP(12,'TFJS…');await tf.ready();setP(22,'TinyFaceDetector…');await faceapi.nets.tinyFaceDetector.loadFromUri(WEIGHTS);setP(40,'Landmarks…');await faceapi.nets.faceLandmark68Net.loadFromUri(WEIGHTS);modelsLoaded=true;setP(50,'Ready');}function dist(a,b){return Math.hypot(a.x-b.x,a.y-b.y)}function compute(pts){const f=dist(pts[2],pts[14])/Math.max(1,dist(pts[27],pts[51]));let d=0,n=0;for(let i=0;i<=8;i++){const L=pts[i],R=pts[16-i];d+=Math.abs(L.y-R.y)+Math.abs((L.x+R.x)-pts[8].x*2);n++;}const sym=Math.max(0,10-(d/Math.max(1,n))/10);const eye=(pts[37].y+pts[44].y)/2,mouth=(pts[62].y+pts[66].y)/2,chin=pts[8].y,top=pts[27].y;const seg1=Math.abs(mouth-eye),seg2=Math.abs(chin-top);const golden=Math.max(0,10-Math.abs(1.618-(seg2/Math.max(1,seg1))/1.618)*10);const agg=Number(((sym+golden+(Math.min(f,2.2)/2.0)*10)/3).toFixed(2));return {fWHR:Number(f.toFixed(2)),symmetry:Number(sym.toFixed(2)),golden:Number(golden.toFixed(2)),aggregate:agg};}function downscale(img,maxDim=1024){const sc=Math.min(1,maxDim/Math.max(img.width,img.height));const c=document.createElement('canvas');c.width=Math.round(img.width*sc);c.height=Math.round(img.height*sc);c.getContext('2d').drawImage(img,0,0,c.width,c.height);const out=new Image();out.width=c.width;out.height=c.height;out.src=c.toDataURL('image/jpeg',0.92);return new Promise(r=>out.onload=()=>r(out));}function detectWithTimeout(img,opts,ms=3500){return Promise.race([faceapi.detectSingleFace(img,opts).withFaceLandmarks(true),new Promise((_,rej)=>setTimeout(()=>rej(new Error('Detection timeout')),ms))]);}async function analyze(){try{setP(5,'Starting…');await ensure();if(!imageBlobUrl){setP(0,'Choose a photo first.');return;}setP(60,'Preparing image…');const raw=new Image();raw.onload=async()=>{const img=await downscale(raw,1024);overlay.width=img.width;overlay.height=img.height;const ctx=overlay.getContext('2d');const sizes=[416,320,256];let det=null,used=null;for(const s of sizes){try{setP(70,'Detecting (Tiny '+s+')…');const opts=new faceapi.TinyFaceDetectorOptions({inputSize:s,scoreThreshold:0.5});det=await detectWithTimeout(img,opts,3500);used=s;if(det)break;}catch(e){log('Retry '+s+' err: '+e.message);await tf.nextFrame();}}if(!det){setP(0,'Could not detect a face.');return;}setP(86,'Computing…');const sc=compute(det.landmarks.positions);ctx.clearRect(0,0,overlay.width,overlay.height);ctx.drawImage(img,0,0,img.width,img.height);const resized=faceapi.resizeResults(det,{width:img.width,height:img.height});faceapi.draw.drawFaceLandmarks(overlay,resized);overlay.style.display='block';setP(100,'Done (Tiny '+used+')');setTimeout(()=>setP(0,''),1500);};raw.src=imageBlobUrl;}catch(e){setP(0,'Error: '+e.message);log('Error: '+e.message);} } $('analyzeBtn').addEventListener('click', analyze);</script></body></html>