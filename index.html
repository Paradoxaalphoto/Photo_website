<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>YorN 1.17.0-alpha</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: sans-serif; background:#111; color:#eee; margin:0; padding:0; }
    header { background:#222; padding:1em; text-align:center; }
    h1 { margin:0; font-size:1.4em; }
    button { margin:0.25em; padding:0.4em 0.8em; border:none; border-radius:4px; cursor:pointer; }
    button.primary { background:#4caf50; color:#fff; }
    button.danger { background:#e53935; color:#fff; }
    section { margin:1em; padding:1em; background:#1b1b1b; border-radius:6px; }
    textarea, select, input[type=text] { width:100%; padding:0.4em; margin-top:0.25em; border-radius:4px; border:1px solid #444; background:#000; color:#eee; }
    .flex { display:flex; flex-wrap:wrap; gap:0.5em; }
    .card { flex:1 1 200px; padding:0.5em; background:#2a2a2a; border-radius:4px; }
    pre { background:#000; color:#0f0; font-size:0.8em; padding:0.5em; overflow-x:auto; }
    .ok { color:#4caf50; } .fail { color:#e53935; }
  </style>
</head>
<body>
  <header><h1>YorN 1.17.0-alpha</h1></header>

  <section>
    <h2>Controls</h2>
    <div>
      <button id="runTest" class="primary">Run Auto-Test</button>
      <button id="copyDiag">Copy Diagnostics</button>
      <button id="copyAuto">Copy Auto-Test</button>
    </div>
    <div>
      <label>Backend:
        <select id="backendSelect">
          <option value="webgl">webgl</option>
          <option value="wasm">wasm</option>
          <option value="cpu">cpu</option>
        </select>
      </label>
    </div>
  </section>

  <section>
    <h2>Diagnostics</h2>
    <pre id="diagLog">(empty)</pre>
  </section>

  <section>
    <h2>Research Mode</h2>
    <div class="flex">
      <div class="card">
        <label>Age Group:
          <select id="ageGroup">
            <option value="">--</option>
            <option>20-24</option><option>25-29</option><option>30-34</option>
            <option>35-39</option><option>40-44</option><option>45-49</option>
            <option>50-54</option><option>55-59</option><option>60-64</option>
            <option>65-69</option><option>70-74</option><option>75-79</option>
          </select>
        </label>
        <label>Sex:
          <select id="raterSex"><option value="">--</option><option>M</option><option>F</option><option>Prefer not</option></select>
        </label>
        <label>Region:
          <input id="raterRegion" type="text" placeholder="Optional"/>
        </label>
      </div>
      <div class="card">
        <label>Attractiveness (1â€“7):
          <select id="rating"><option value="">--</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option></select>
        </label>
        <label><input type="checkbox" id="chkFollow"> Would follow</label><br/>
        <label><input type="checkbox" id="chkHire"> Would hire</label><br/>
        <label><input type="checkbox" id="chkDate"> Would date</label>
      </div>
      <div class="card">
        <label>Notes:<textarea id="notes" maxlength="280"></textarea></label>
      </div>
    </div>
    <div>
      <button id="submitRow" class="primary">Submit Rating</button>
    </div>
  </section>

  <section>
    <h2>Dataset</h2>
    <div>
      <button id="exportCSV">Export CSV</button>
      <button id="exportJSON">Export JSON</button>
      <button id="clearDS" class="danger">Clear Dataset</button>
      <button id="copySummary">Copy Dataset Summary</button>
    </div>
    <pre id="dsSummary">(no rows yet)</pre>
  </section>

  <script>
    const diagLog = document.getElementById("diagLog");
    function log(msg,obj){ 
      const line = JSON.stringify({time:new Date().toISOString(),...msg,...obj}); 
      diagLog.textContent += line+"\\n"; 
      diagLog.scrollTop=diagLog.scrollHeight; 
    }
    function copyText(txt){ 
      navigator.clipboard.writeText(txt).catch(()=>{ 
        const ta=document.createElement("textarea"); ta.value=txt; document.body.appendChild(ta); ta.select(); document.execCommand("copy"); document.body.removeChild(ta); 
      }); 
    }

    // dataset
    let dataset = JSON.parse(localStorage.getItem("yornDataset")||"[]");
    function saveDS(){ localStorage.setItem("yornDataset",JSON.stringify(dataset)); updateSummary(); }
    function updateSummary(){
      if(!dataset.length){ document.getElementById("dsSummary").textContent="(no rows yet)"; return; }
      let counts={};
      for(let r of dataset){ let k=r.rater_age+"|"+r.rater_sex; counts[k]=(counts[k]||0)+1; }
      document.getElementById("dsSummary").textContent="Rows: "+dataset.length+"\\n"+JSON.stringify(counts,null,2);
    }
    updateSummary();

    document.getElementById("submitRow").onclick=()=>{
      const row={
        session_id:"sess-"+Date.now(),
        timestamp:new Date().toISOString(),
        photo_id:"sample",
        box_x:0,box_y:0,box_w:0,box_h:0,face_area_pct:0,
        brightness:0,contrast:0,sharpness:0,
        rater_age:ageGroup.value,
        rater_sex:raterSex.value,
        rater_region:raterRegion.value,
        rating_1to7:rating.value,
        would_follow:chkFollow.checked,
        would_hire:chkHire.checked,
        would_date:chkDate.checked,
        notes:notes.value,
        app_rev:"1.17.0-alpha",tf_backend:"mock"
      };
      dataset.push(row); saveDS();
      log({type:"dataset_add"},row);
    };

    document.getElementById("exportCSV").onclick=()=>{
      let headers=Object.keys(dataset[0]||{});
      let csv=[headers.join(",")];
      for(let r of dataset){ csv.push(headers.map(h=>JSON.stringify(r[h]||"")).join(",")); }
      copyText(csv.join("\\n")); alert("CSV copied to clipboard.");
    };
    document.getElementById("exportJSON").onclick=()=>{ copyText(JSON.stringify(dataset,null,2)); alert("JSON copied."); };
    document.getElementById("clearDS").onclick=()=>{ if(confirm("Clear dataset?")){ dataset=[]; saveDS(); } };
    document.getElementById("copySummary").onclick=()=>{ copyText(document.getElementById("dsSummary").textContent); };

    document.getElementById("copyDiag").onclick=()=>copyText(diagLog.textContent);
    document.getElementById("copyAuto").onclick=()=>copyText(diagLog.textContent);

    document.getElementById("runTest").onclick=()=>{
      log({type:"test",step:"begin",rev:"1.17.0-alpha"});
      if(dataset){ log({type:"test",step:"dataset_schema",ok:true,rows:dataset.length}); }
      log({type:"test",step:"summary",ok:true});
    };

    // boot log
    log({type:"config",boot:"dom-ready",rev:"1.17.0-alpha"});
    log({type:"config",boot:"complete"});
  </script>
</body>
</html>