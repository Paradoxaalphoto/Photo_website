<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>YorN — 1.11.1 boot-probe</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- Try to neutralize common blockers -->
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https: data: blob:; img-src * data: blob:; connect-src * data: blob:; style-src 'self' 'unsafe-inline'; object-src 'none'; base-uri 'self'; frame-ancestors 'self'; upgrade-insecure-requests">
<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<style>
  :root{color-scheme:light dark}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,sans-serif;background:#0b1220;color:#e6eaf2}
  .wrap{max-width:920px;margin:0 auto;padding:16px}
  .banner{background:#16a34a15;border:1px solid #16a34a55;padding:10px 12px;border-radius:12px;margin:12px 0;font:14px ui-monospace,monospace}
  .row{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0}
  .btn{background:#1f2937;color:#e6eaf2;border:1px solid #233046;border-radius:8px;padding:10px 14px;cursor:pointer}
  .btn[disabled]{opacity:.5;cursor:not-allowed}
  input[type="file"]{padding:8px;border:1px solid #233046;border-radius:8px;background:#0b1220;color:#e6eaf2}
  #diag{white-space:pre-wrap;font:12px ui-monospace,menlo,consolas,monospace;background:#0b1220;border:1px solid #233046;border-radius:12px;padding:10px;height:240px;overflow:auto}
  #preview{display:block;width:100%;height:auto;margin-top:10px;background:#0b1220;border:1px solid #233046;border-radius:12px}
  #rev{position:fixed;right:10px;top:10px;font:12px ui-monospace,monospace;background:#0008;color:#fff;border:1px solid #fff3;padding:3px 8px;border-radius:999px}
</style>

<script>
/* ultra-early boot logger */
(function(){
  window.__yornLogs = window.__yornLogs || [];
  function bootLog(type, payload){ try{
    const line = `[${new Date().toISOString()}] ` + JSON.stringify({type, ...(payload||{})}) + "\n";
    window.__yornLogs.unshift(line);
  }catch(_){ }
  }
  window.__yornBootLog = bootLog;
  window.addEventListener('error', e=>bootLog('error',{global:e.message,at:(e.filename||'')+':'+(e.lineno||'')}));
  window.addEventListener('unhandledrejection', e=>{const r=e&&e.reason; bootLog('error',{unhandled:(r&&(r.message||r))||String(r)})});
  bootLog('config',{boot:'starting', ua:navigator.userAgent });
})();
</script>
</head>
<body>
<div id="rev">YorN Rev 1.11.1-boot-probe</div>
<div class="wrap">
  <h2>YorN — Boot Probe</h2>
  <div id="banner" class="banner">If you can see this, HTML loaded. Waiting for JS…</div>

  <div class="row">
    <button id="ping" class="btn">Ping Log</button>
    <button id="loadSample" class="btn">Load Sample Image</button>
    <input id="file" type="file" accept="image/*">
    <button id="copyDiag" class="btn" disabled>Copy Diagnostics</button>
    <button id="hardReload" class="btn">Hard Reload (add ?v=ts)</button>
  </div>

  <img id="preview" alt="preview will appear here" />

  <h3 style="margin:12px 0 6px">Diagnostics</h3>
  <div id="diag">No diagnostics yet.</div>
</div>

<script>
const REV="1.11.1-boot-probe";
const $=id=>document.getElementById(id);
const diag=$("diag"), banner=$("banner"), preview=$("preview");
const copyDiag=$("copyDiag");

function appendTop(s){ diag.textContent = s + diag.textContent; copyDiag.disabled = diag.textContent.trim().length===0 || diag.textContent.includes("No diagnostics yet.") }
function log(type,payload){ appendTop(`[${new Date().toISOString()}] ${JSON.stringify({type,...(payload||{})})}\n`) }

/* flush any early logs */
(function(){
  try{
    if (Array.isArray(window.__yornLogs) && window.__yornLogs.length){
      appendTop(window.__yornLogs.join(""));
      window.__yornLogs.length = 0;
    }
  }catch(_){}
  banner.textContent = "JS running ✅ — logger online ("+REV+")";
  log('config',{boot:'ui-ready', rev:REV});
})();

/* global traps post-boot too */
window.addEventListener('error', e=>log('error',{global:e.message, at:(e.filename||'')+':'+(e.lineno||'')}));
window.addEventListener('unhandledrejection', e=>{ const r=e&&e.reason; log('error',{unhandled:(r&&(r.message||r))||String(r)})});

/* buttons */
$("ping").onclick = ()=> log('config',{ping:'pong', ts:Date.now()});

$("loadSample").onclick = async ()=>{
  const u="https://images.unsplash.com/photo-1502685104226-ee32379fefbe?q=80&w=1000&auto=format&fit=crop";
  log('detect',{sampleFetch:u});
  try{
    const res=await fetch(u,{cache:'no-store'}); if(!res.ok) throw new Error('HTTP '+res.status);
    const blob=await res.blob();
    const url=URL.createObjectURL(blob);
    preview.onload=()=>{ URL.revokeObjectURL(url); log('overlay',{painted:{w:preview.naturalWidth,h:preview.naturalHeight}}) };
    preview.onerror=()=>{ URL.revokeObjectURL(url); log('error',{img:'onerror'}) };
    preview.src=url;
    log('detect',{decode:'blob->img', size_bytes:blob.size});
  }catch(e){
    log('error',{sample_failed:e.message||String(e)});
  }
};

$("file").onchange = async ()=>{
  if(!$("file").files.length) return;
  const f=$("file").files[0];
  log('detect',{file:f.name,size_bytes:f.size});
  try{
    const url=URL.createObjectURL(f);
    preview.onload=()=>{ URL.revokeObjectURL(url); log('overlay',{painted:{w:preview.naturalWidth,h:preview.naturalHeight}}) };
    preview.onerror=()=>{ URL.revokeObjectURL(url); log('error',{img:'onerror-file'}) };
    preview.src=url;
  }catch(e){ log('error',{decode_failed:e.message||String(e)}) }
};

copyDiag.onclick = async ()=>{ try{ await navigator.clipboard.writeText(diag.textContent); log('config',{copied:true}) }catch(e){ log('error',{copy:e.message||String(e)}) } };
$("hardReload").onclick = ()=>{ const sep = location.search ? '&' : '?'; location.href = location.pathname + location.search + sep + 'v=' + Date.now() };
</script>
</body>
</html>